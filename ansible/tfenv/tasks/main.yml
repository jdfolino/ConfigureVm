---
- name: Update and upgrade apt packages
  become: true
  apt:
    upgrade: yes
    update_cache: yes
    cache_valid_time: 86400 #One day

- name: Install gnupg (state=present is optional)
  apt:
    name: gnupg
    state: present

- name: Install software-properties-common (state=present is optional)
  apt:
    name: software-properties-common
    state: present

- name: Install curl (state=present is optional)
  apt:
    name: curl
    state: present

- name: Add an Apt signing key, uses whichever key is at the URL
  ansible.builtin.apt_key:
    url: https://apt.releases.hashicorp.com/gpg
    state: present


- name: Add specified repository into sources list
  ansible.builtin.apt_repository:
    repo: "deb [arch=amd64] https://apt.releases.hashicorp.com focal main"
    state: present

- name: Install terraform (state=present is optional)
  apt:
    name: terraform
    state: present

# tasks file for tfenv
- name: Git checkout tfenv
  ansible.builtin.git:
    repo: "https://github.com/tfutils/tfenv.git"
    dest: "/home/azureuser/.tfenv"

- name: Create a symbolic link
  ansible.builtin.file:
    src: "/home/azureuser/.tfenv/bin/tfenv"
    dest: /usr/local/bin/tfenv
    state: link

- name: Install terraform latest (stable)
  ansible.builtin.command: tfenv install 1.0.10  
